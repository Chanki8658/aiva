machine:
  node:
    version: 6
  services:
    - docker
  environment:
    COVERALLS_REPO_TOKEN: etDLVZ6U9Q77ilGeLwhNd76OB9JMJdL6d

dependencies:
  pre:
    - docker pull kengz/aiva

test:
  override:
    - docker run -it -d -p 4041:4038 -p 7476:7475 -p 6466:6465 --name aiva-development -v `pwd`:/opt/aiva kengz/aiva /bin/bash -c 'cd /opt/aiva && bash bin/copy-env.sh && npm test'; sleep 60
    - docker logs aiva-development
  post:
    - "cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js && rm -rf ./coverage"
